var model, view, controller, vie, mm, cont;

window.exampleJsFunctions = {
    initialize: function (dotnetObj) {
        model = CodeMirror.fromTextArea(document.getElementById("modelCode"), {
            mode: 'text/x-csharp',
            lineNumbers: true
        });

        view = CodeMirror.fromTextArea(document.getElementById("viewCode"), {
            mode: 'text/x-csharp',
            lineNumbers: true
        });
        controller = CodeMirror.fromTextArea(document.getElementById("controllerCode"), {
            mode: 'text/html',
            lineNumbers: !0,
            autoCloseTags: !0,
            extraKeys: {
                "Ctrl-Space": "autocomplete"
            },
            styleActiveLine: !0
        });
        document.getElementById("runbutton").addEventListener("click", function () {
            var mm = model.getValue();
            var vie = view.getValue();
            var cont = controller.getValue();
            var getValue = { pages: vie, startup: mm, host: cont };
            dotnetObj.invokeMethodAsync("onBuild", getValue);
        });
    },

    renderIframe: function (dotnetObj) {
        //var iframeEle = document.createElement("iframe");
        //iframeEle.setAttribute("src", hostApp);
        // iframeEle.setAttribute("style", "width: 100%; height: 240px");
        document.getElementById("iframe").innerHTML = '<iframe src="http://localhost/blazorOutput/" id="output" style="width: 100%; height: 240px"></iframe>';
    }
}
$(function () { 
    
    function getTutorialSample() {
        $.ajax({
            url: 'Default/GetTemplate',
            dataType: 'json',
            method: 'post',
            data: {},
            success: function (t) { 
                view.setValue(t.result);
            }

        });
    }
    window.onload = getTutorialSample;

    $("#save").click(function (e) {
        fun1();
        fun2();
        //fun3();
        document.getElementById("viewCode").removeAttribute();
    });
    var fun1 = (function () {
        $.ajax({
            url: '/Default/GenerateID',
            method: 'post',
            data: "{}",
            sucess: function (e) {
                console.log(e);
            }
        });
    });

    function fun2() {

         mm = model.getValue();
         vie = view.getValue();
         cont = controller.getValue();
        $.ajax({
            url: '/Default/InsertHtmlContent',
            method: 'post',
            data: { model: mm, view: vie, controller: cont },
            success: function (e) {
                console.log(e);
                window.location.href = 'http://localhost:8085/Default/SplitterFeatures/' + e;
            }
        });

    };
    //model = CodeMirror.fromTextArea(document.getElementById("modelCode"), {
    //    mode: 'text/x-csharp',
    //    lineNumbers: true
    //});

    //view = CodeMirror.fromTextArea(document.getElementById("viewCode"), {
    //    mode: 'text/html',
    //    lineNumbers: true
    //});
    //controller = CodeMirror.fromTextArea(document.getElementById("controllerCode"), {
    //    mode: 'text/x-csharp',
    //    lineNumbers: !0,
    //    autoCloseTags: !0,
    //    extraKeys: {
    //        "Ctrl-Space": "autocomplete"
    //    },
    //    styleActiveLine: !0
    //});
    function getTutorialSample() {
        $.ajax({
            url: 'Default/GetTemplate',
            dataType: 'json',
            method: 'post',
            data: {},
            success: function (e) {
             //   console.log(e);
                view.setValue(e.result);
            }

        });
    }
    function callToApi() {
        var mm = model.getValue();
        var vie = view.getValue();
        var cont = controller.getValue();
        $.ajax({ 
            url: '/Default/GetResultFromBuildEngine',
            dataType: 'JSON',
            method: 'post',
            data: { view: vie, model: mm, controller: cont },
            success: function (dat) { 
                if (dat[0] == "Build started.") {
                    dat[1] = dat[1].replace("Build succeeded", "<span class='green'>Build Success</span>");
                    $('#error').html("<div class='compileDetails'>" + dat + "</div>");
                }
                else {
                    $("#error").html("<div>" + "Build started.,Build Finished: <span class='red'> Build Failed. </span>" + "</div>");
                    $("#error").append("<div>" + "LineNumber: " + dat.lineNumber + "</div>");
                    $("#error").append("<div>" + "ColumnNumber: " + dat.columnNumber + "</div>");
                    $("#error").append("<div>" + "Message: " + dat.message + "</div>");
                }
            }

        });
    }
   
});
 
 
 